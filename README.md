Bosh & Concourse
================

Bosh & Concourse (or bnc) is yet another tool to deploy Bosh and
Concourse (with UAA and Credhub).

But why ? don't we already have tools to do that ? Well yes. Bnc is
just a short bash script that wraps BOSH BootLoader (bbl). Bbl is the
fastest way I could find to have a Bosh running on my IaaS provider.
But when it comes to deploy Concourse, there are still a couple of
[manual steps to be performed][1]. Bnc just does that in a script
(`bnc.sh`).

Also it provides a Dockerfile, that builds a container with all the
tooling required to run Bnc (including Bosh, Terraform, Bbl and Bnc).


How to use
==========

`bnc.sh` needs to be launched in the "bbl state directory" (an
initially empty directory, which will be populated with the files
generated by bbl).

It fully relies on 2 files:

* `envrc`
* `vars/concourse-vars-file.yml`

`envrc` exports the [environment variables required by bbl][4]. For
example:

```
export BBL_IAAS=gcp
export BBL_GCP_REGION=europe-west1
export BBL_GCP_SERVICE_ACCOUNT_KEY=<path-to-gcp-service-account-key>
```

`vars/concourse-vars-file.yml` defines all [the variables to be used
be the Concourse deployment manifest][1], except `external_host` and
`external_url`. These latest variables are automatically provided by
the script. For example:

```
local_user:
  username: "admin"
  password: <your-secure-password>
network_name: 'private'
web_instances: 1
web_network_name: 'private'
web_vm_type: 'default'
web_network_vm_extension: 'lb'
db_vm_type: 'default'
db_persistent_disk_type: '1GB'
worker_instances: 2
worker_vm_type: 'default'
worker_ephemeral_disk: '50GB_ephemeral_disk'
deployment_name: 'concourse'
```

Once these 2 configuration files have been written, bnc can be
launched:

```
$ bnc.sh
```

The URL to be used to connect to Concourse is displayed by the script
when it finishes. It can also be retrieved with the following command:

```
$ terraform output -state vars/terraform.tfstate concourse_lb_ip
```

To use the bosh CLI, the `bbl print-env` [command][5] can be used to
provide the environment variables required by `bosh`:

```
$ eval "$(bbl print-env)"
```

Tearing down the platform:

```
$ source envrc
$ bosh -n -d concourse delete-deployment
$ bbl -n down
```


Notes
=====

Bnc currently only works with GCP.

Related tools:
* [bosh-bootloader][2]
* [BUCC][3]


[1]: https://github.com/cloudfoundry/bosh-bootloader/blob/master/docs/concourse.md
[2]: https://github.com/cloudfoundry/bosh-bootloader
[3]: https://github.com/starkandwayne/bucc
[4]: https://github.com/cloudfoundry/bosh-bootloader/blob/master/docs/getting-started-gcp.md
[5]: https://github.com/cloudfoundry/bosh-bootloader/blob/master/docs/howto-target-bosh-director.md
